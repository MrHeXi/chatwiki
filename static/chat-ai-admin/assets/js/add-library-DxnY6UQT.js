import{_ as J,L as oe,d as V,M as te,ao as $,c as le,B as ne}from"../../index.js";import{e as _,w as re,M as s,N as m,a9 as Y,k as n,S as r,W as d,Q as F,u as y,a4 as Q,a5 as W,a0 as se,B as z,V as w,F as j,a2 as D,a3 as G,Z as C,Y as E,a8 as ie}from"./vue-chunks-Chs-lyDX.js";import{U as ce}from"./upload-input-DzWNjCY0.js";import{c as ue}from"./index-DByfIRTu.js";import{b as _e}from"./index-Cz_YIDX3.js";import{F as R,_ as de}from"./index-VeYSCPCu.js";import{P as pe}from"./PlusOutlined-BUnPSW1-.js";import{_ as me}from"./index-DHBKO1se.js";import"./index-9H-48H6s.js";import{I as fe}from"./Password-cmG-BlhH.js";import{_ as ve}from"./TextArea-DvaABMYL.js";import{_ as ge}from"./index-CXtWJzyp.js";import{S as be,a as ye,_ as he}from"./index-MD3V6K2I.js";import"./dayjs-CkLU8sYs.js";import"./axios-Cm0UX6qg.js";import"./qs-DjYKlG5V.js";import"./crypto-js-BUUKnz8c.js";import"./index-DBNqHYGh.js";import"./Col-CvDsueo7.js";import"./collapseMotion-DN2MDQ98.js";import"./QuestionCircleOutlined-B0hVewZq.js";import"./inputProps-DYO7gEw-.js";import"./CheckOutlined-D4HtVfaw.js";import"./index-CwZHIw9t.js";import"./slide-CP07UJ8x.js";import"./DownOutlined-DRniQ56W.js";import"./move-DwQ0mPkQ.js";const ke=i=>(Q("data-v-9db3840d"),i=i(),W(),i),we={class:"avatar-uploader"},Ce=["src"],Fe=ke(()=>d("div",{class:"ant-upload-text"},"上传照片",-1)),Ie=["src"],xe={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(i,{emit:I}){function x(a){return new Promise((g,b)=>{const u=new FileReader;u.readAsDataURL(a),u.onload=()=>g(u.result),u.onerror=o=>b(o)})}const L=I,f=i,p=_([]),t=_(!1),A=_("");re(()=>f.value,a=>{A.value=a},{immediate:!0});const U=R.useInjectFormItemContext(),P=()=>{let a={imageUrl:A.value,file:p.value[0].originFileObj};L("change",a),L("update:value",a.imageUrl),U.onFieldChange()},v=a=>a.type==="image/jpeg"||a.type==="image/png"?a.size/1024<100?(p.value=[a],x(a).then(u=>{A.value=u,t.value=!1,P()}),!1):(V.error("知识库封面图片大小不能超过100kb"),!1):(V.error("知识库封面只支持JPG、PNG格式的图片"),!1),h=_(!1),S=_(""),k=_(""),M=()=>{h.value=!1,k.value=""},O=async a=>{!a.url&&!a.preview&&(a.preview=await x(a.originFileObj)),S.value=a.url||a.preview,h.value=!0,k.value=a.name||a.url.substring(a.url.lastIndexOf("/")+1)};return(a,g)=>{const b=me,u=te;return s(),m("div",we,[i.value?(s(),m("img",{key:0,class:"avatar",src:i.value,alt:"avatar"},null,8,Ce)):Y("",!0),n(b,{class:"upload-upload","file-list":p.value,"onUpdate:fileList":g[0]||(g[0]=o=>p.value=o),"list-type":"picture-card","show-upload-list":!1,"before-upload":v,accept:".jpg,.png,.jpeg",onPreview:O},{default:r(()=>[d("div",null,[t.value?(s(),F(y(oe),{key:0})):(s(),F(y(pe),{key:1})),Fe])]),_:1},8,["file-list"]),n(u,{open:h.value,title:k.value,footer:null,onCancel:M},{default:r(()=>[d("img",{alt:"example",style:{width:"100%"},src:S.value},null,8,Ie)]),_:1},8,["open","title"])])}}},Le=J(xe,[["__scopeId","data-v-9db3840d"]]),Ae=i=>(Q("data-v-fc45784c"),i=i(),W(),i),Se={class:"add-library-page"},Ne={class:"form-box"},Ue=Ae(()=>d("div",{class:"form-item-tip"},"请上传知识库封面，建议尺寸为100*100px.大小不超过100kb",-1)),Pe={class:"card-box"},Me=["onClick"],Oe=["src"],Be={key:0},$e={key:1},je={__name:"add-library",setup(i){const I=se(),x=_([{iconName:"high",iconNameActive:"high-active",title:"高质量",value:1,is_offline:!1,desc:"使用在线的嵌入模型，在召回时具有更高的准确度，但需要花费token"},{iconName:"economic",iconNameActive:"economic-active",title:"经济",value:2,is_offline:!0,desc:"使用离线的向量模型，较在线模型准确度稍低，但是不需要消耗token"}]),L=R.useForm,f=_(2),p=_(!1),t=z({library_name:"",library_intro:"",use_model:void 0,model_config_id:"",library_files:void 0,avatar:$,robot_avatar_url:$,is_offline:!1}),U=z({library_name:[{required:!0,message:"请输入库名称",trigger:"blur"}],library_intro:[{required:!0,message:"请输入库简介",trigger:"blur"}],use_model:[{required:!0,message:"请选择嵌入模型",trigger:"change"}],library_files:[{required:!0,message:"请选择文件",trigger:"change",validator:(o,l)=>l&&l.length>0?Promise.resolve():Promise.reject(new Error("请上传文件"))}]}),{validate:P,validateInfos:v}=L(t,U),h=o=>{t.library_files=o},S=(o,l)=>{t.model_config_id=l.model_config_id},k=o=>{t.avatar=o.file},M=o=>{t.is_offline=o.is_offline,f.value=o.value,t.use_model=void 0,u(o.is_offline)},O=()=>{I.back()},a=()=>{P().then(()=>{g()}).catch(()=>{})},g=()=>{let o=new FormData;o.append("library_name",t.library_name),o.append("library_intro",t.library_intro),o.append("use_model",t.use_model),o.append("model_config_id",t.model_config_id),o.append("avatar",t.avatar||$),o.append("is_offline",t.is_offline),t.library_files.forEach(l=>{o.append("library_files",l)}),p.value=!0,ue(o).then(l=>{p.value=!1,V.success("创建成功"),I.replace({path:"/library/document-segmentation",query:{document_id:l.data.file_ids[0]}})}).catch(()=>{p.value=!1})},b=_([]),u=o=>{_e({model_type:"TEXT EMBEDDING",is_offline:o}).then(l=>{let B=l.data||[];b.value=B.map(c=>({id:c.model_config.id,name:c.model_info.model_name,icon:c.model_info.model_icon_url,children:c.model_info.vector_model_list,deployment_name:c.model_config.deployment_name}))})};return u(!0),(o,l)=>{const B=fe,c=de,X=ve,T=le,Z=ge,H=be,K=ye,ee=he,q=ne,ae=R;return s(),m("div",Se,[d("div",Ne,[n(ae,{"label-col":{span:4}},{default:r(()=>[n(c,w({ref:"name",label:"知识库名称"},y(v).library_name),{default:r(()=>[n(B,{value:t.library_name,"onUpdate:value":l[0]||(l[0]=e=>t.library_name=e),placeholder:"请输入知识库名称，最多20个字"},null,8,["value"])]),_:1},16),n(c,w({label:"知识库简介"},y(v).library_intro),{default:r(()=>[n(X,{value:t.library_intro,"onUpdate:value":l[1]||(l[1]=e=>t.library_intro=e),placeholder:"请输入知识库介绍"},null,8,["value"])]),_:1},16),n(c,w({ref:"name",label:"知识库封面"},y(v).robot_avatar_url),{default:r(()=>[n(Le,{value:t.robot_avatar_url,"onUpdate:value":l[2]||(l[2]=e=>t.robot_avatar_url=e),onChange:k},null,8,["value"]),Ue]),_:1},16),n(c,w({ref:"name",label:"知识库文档"},y(v).library_files),{default:r(()=>[n(ce,{onChange:h})]),_:1},16),n(c,w({label:"嵌入模型 "},y(v).use_model),{default:r(()=>[d("div",Pe,[(s(!0),m(j,null,D(x.value,e=>(s(),m("div",{class:G(["use-model-item",{active:f.value==e.value}]),key:e.value,onClick:N=>M(e)},[d("div",{class:G(["use-model-item-top",{active:f.value==e.value}])},[n(T,{class:"use-model-item-top-icon",style:{color:"red"},name:f.value==e.value?e.iconNameActive:e.iconName},null,8,["name"]),d("p",null,C(e.title),1)],2),d("p",null,C(e.desc),1),f.value==e.value?(s(),F(T,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):Y("",!0)],10,Me))),128))]),n(ee,{value:t.use_model,"onUpdate:value":l[3]||(l[3]=e=>t.use_model=e),placeholder:"请选择嵌入模型",onChange:S},{default:r(()=>[(s(!0),m(j,null,D(b.value,e=>(s(),F(K,{key:e.id},{label:r(()=>[n(Z,{align:"center",gap:6},{default:r(()=>[d("img",{class:"model-icon",src:e.icon,alt:""},null,8,Oe),E(C(e.name),1)]),_:2},1024)]),default:r(()=>[(s(!0),m(j,null,D(e.children,N=>(s(),F(H,{value:N,model_config_id:e.id,key:N},{default:r(()=>[e.name=="Azure OpenAI Service"&&e.deployment_name?(s(),m("span",Be,C(e.deployment_name),1)):(s(),m("span",$e,C(N),1))]),_:2},1032,["value","model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])]),_:1},16),n(c,{"wrapper-col":{span:14,offset:4}},{default:r(()=>[n(q,{onClick:O},{default:r(()=>[E("取 消")]),_:1}),n(q,{type:"primary",style:{"margin-left":"16px"},loading:p.value,onClick:ie(a,["prevent"])},{default:r(()=>[E("下一步")]),_:1},8,["loading"])]),_:1})]),_:1})])])}}},_a=J(je,[["__scopeId","data-v-fc45784c"]]);export{_a as default};
