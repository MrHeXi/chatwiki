var dt=Object.defineProperty;var ut=(e,o,a)=>o in e?dt(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a;var le=(e,o,a)=>(ut(e,typeof o!="symbol"?o+"":o,a),a);import{f as Ne,s as K,x as Me,z as ue,w as se,D as qe,k as c,q as Re,G as Ie,H as Pe,e as R,b as ne,d as pt,p as mt,o as ft,K as _t,B as xe,M as k,N as S,W as n,F as Y,a2 as Z,Z as j,S as L,a9 as G,u as z,aa as ye,a4 as we,a5 as ke,a3 as Ge,Q as be,Y as W,a0 as vt,a1 as je,a7 as ht,a6 as gt}from"./vue-chunks-Chs-lyDX.js";import{O as ie,a2 as A,a3 as re,a4 as yt,a5 as bt,S as Ee,X as Q,a6 as Qe,a7 as wt,a8 as Ze,a9 as kt,K as St,N as Ct,H as $t,R as xt,aa as Ot,W as Be,ab as Fe,ac as Mt,ad as Le,T as Ae,I as Te,ae as Tt,af as He,G as $e,_ as pe,c as et,B as tt,a as Lt,ag as ze,M as It,E as Pt,ah as Et}from"../../index.js";import{f as Nt,s as qt}from"./index-B0ITeg-u.js";import{S as ot}from"./index-B8boHKw3.js";import{Q as ae}from"./QuestionCircleOutlined-B0hVewZq.js";import{_ as De}from"./index-DBNqHYGh.js";import{C as At}from"./cu-scroll-Dlyosbal.js";import{b as Dt}from"./index-Cz_YIDX3.js";import{_ as nt}from"./TextArea-DvaABMYL.js";import{_ as Rt}from"./index-CXtWJzyp.js";import{S as jt,a as Bt,_ as Ft}from"./index-MD3V6K2I.js";import{_ as Ht}from"./index-DCqvJzzh.js";import{_ as zt}from"./index-BUlbC6Wf.js";import{u as Ut}from"./robot-DBUyLf8u.js";import{B as Wt,_ as Vt}from"./index-gc4pTQWL.js";import{P as Jt}from"./PlusOutlined-BUnPSW1-.js";import"./dayjs-CkLU8sYs.js";import"./axios-Cm0UX6qg.js";import"./qs-DjYKlG5V.js";import"./crypto-js-BUUKnz8c.js";import"./inputProps-DYO7gEw-.js";import"./index-CwZHIw9t.js";import"./slide-CP07UJ8x.js";import"./CheckOutlined-D4HtVfaw.js";import"./DownOutlined-DRniQ56W.js";import"./move-DwQ0mPkQ.js";import"./dropdown-T3bZiTSp.js";import"./RightOutlined-BSM_93j-.js";import"./index-C9DKKAWk.js";import"./collapseMotion-DN2MDQ98.js";const Ue=e=>!isNaN(parseFloat(e))&&isFinite(e),at=()=>({prefixCls:String,width:A.oneOfType([A.string,A.number]),height:A.oneOfType([A.string,A.number]),style:{type:Object,default:void 0},class:String,rootClassName:String,rootStyle:re(),placement:{type:String},wrapperClassName:String,level:{type:[String,Array]},levelMove:{type:[Number,Function,Array]},duration:String,ease:String,showMask:{type:Boolean,default:void 0},maskClosable:{type:Boolean,default:void 0},maskStyle:{type:Object,default:void 0},afterVisibleChange:Function,keyboard:{type:Boolean,default:void 0},contentWrapperStyle:yt(),autofocus:{type:Boolean,default:void 0},open:{type:Boolean,default:void 0},motion:bt(),maskMotion:re()}),Yt=()=>ie(ie({},at()),{forceRender:{type:Boolean,default:void 0},getContainer:A.oneOfType([A.string,A.func,A.object,A.looseBool])}),Xt=()=>ie(ie({},at()),{getContainer:Function,getOpenCount:Function,scrollLocker:A.any,inline:Boolean});function Kt(e){return Array.isArray(e)?e:[e]}const Gt={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend"};Object.keys(Gt).filter(e=>{if(typeof document>"u")return!1;const o=document.getElementsByTagName("html")[0];return e in(o?o.style:{})})[0];const Qt=!(typeof window<"u"&&window.document&&window.document.createElement);var Zt=function(e,o){var a={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&o.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(e);s<t.length;s++)o.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(e,t[s])&&(a[t[s]]=e[t[s]]);return a};const eo=Ne({compatConfig:{MODE:3},inheritAttrs:!1,props:Xt(),emits:["close","handleClick","change"],setup(e,o){let{emit:a,slots:t}=o;const s=K(),f=K(),i=K(),d=K(),y=K();let p=[];`${Number((Date.now()+Math.random()).toString().replace(".",Math.round(Math.random()*9).toString())).toString(16)}`,Me(()=>{ue(()=>{var r;const{open:u,getContainer:C,showMask:P,autofocus:T}=e,l=C==null?void 0:C();M(e),u&&(l&&(l.parentNode,document.body),ue(()=>{T&&v()}),P&&((r=e.scrollLocker)===null||r===void 0||r.lock()))})}),se(()=>e.level,()=>{M(e)},{flush:"post"}),se(()=>e.open,()=>{const{open:r,getContainer:u,scrollLocker:C,showMask:P,autofocus:T}=e,l=u==null?void 0:u();l&&(l.parentNode,document.body),r?(T&&v(),P&&(C==null||C.lock())):C==null||C.unLock()},{flush:"post"}),qe(()=>{var r;const{open:u}=e;u&&(document.body.style.touchAction=""),(r=e.scrollLocker)===null||r===void 0||r.unLock()}),se(()=>e.placement,r=>{r&&(y.value=null)});const v=()=>{var r,u;(u=(r=f.value)===null||r===void 0?void 0:r.focus)===null||u===void 0||u.call(r)},w=r=>{a("close",r)},_=r=>{r.keyCode===wt.ESC&&(r.stopPropagation(),w(r))},b=()=>{const{open:r,afterVisibleChange:u}=e;u&&u(!!r)},M=r=>{let{level:u,getContainer:C}=r;if(Qt)return;const P=C==null?void 0:C(),T=P?P.parentNode:null;p=[],u==="all"?(T?Array.prototype.slice.call(T.children):[]).forEach(x=>{x.nodeName!=="SCRIPT"&&x.nodeName!=="STYLE"&&x.nodeName!=="LINK"&&x!==P&&p.push(x)}):u&&Kt(u).forEach(l=>{document.querySelectorAll(l).forEach(x=>{p.push(x)})})},F=r=>{a("handleClick",r)},H=K(!1);return se(f,()=>{ue(()=>{H.value=!0})}),()=>{var r,u;const{width:C,height:P,open:T,prefixCls:l,placement:x,level:q,levelMove:X,ease:de,duration:me,getContainer:fe,onChange:m,afterVisibleChange:$,showMask:B,maskClosable:g,maskStyle:E,keyboard:D,getOpenCount:h,scrollLocker:O,contentWrapperStyle:N,style:V,class:ee,rootClassName:_e,rootStyle:he,maskMotion:Ce,motion:ge,inline:I}=e,U=Zt(e,["width","height","open","prefixCls","placement","level","levelMove","ease","duration","getContainer","onChange","afterVisibleChange","showMask","maskClosable","maskStyle","keyboard","getOpenCount","scrollLocker","contentWrapperStyle","style","class","rootClassName","rootStyle","maskMotion","motion","inline"]),J=T&&H.value,oe=Ee(l,{[`${l}-${x}`]:!0,[`${l}-open`]:J,[`${l}-inline`]:I,"no-mask":!B,[_e]:!0}),te=typeof ge=="function"?ge(x):ge;return c("div",Q(Q({},Qe(U,["autofocus"])),{},{tabindex:-1,class:oe,style:he,ref:f,onKeydown:J&&D?_:void 0}),[c(Re,Ce,{default:()=>[B&&Ie(c("div",{class:`${l}-mask`,onClick:g?w:void 0,style:E,ref:i},null),[[Pe,J]])]}),c(Re,Q(Q({},te),{},{onAfterEnter:b,onAfterLeave:b}),{default:()=>[Ie(c("div",{class:`${l}-content-wrapper`,style:[N],ref:s},[c("div",{class:[`${l}-content`,ee],style:V,ref:y},[(r=t.default)===null||r===void 0?void 0:r.call(t)]),t.handler?c("div",{onClick:F,ref:d},[(u=t.handler)===null||u===void 0?void 0:u.call(t)]):null]),[[Pe,J]])]})])}}}),We=eo;var Ve=function(e,o){var a={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&o.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(e);s<t.length;s++)o.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(e,t[s])&&(a[t[s]]=e[t[s]]);return a};const to=Ne({compatConfig:{MODE:3},inheritAttrs:!1,props:Ze(Yt(),{prefixCls:"drawer",placement:"left",getContainer:"body",level:"all",duration:".3s",ease:"cubic-bezier(0.78, 0.14, 0.15, 0.86)",afterVisibleChange:()=>{},showMask:!0,maskClosable:!0,maskStyle:{},wrapperClassName:"",keyboard:!0,forceRender:!1,autofocus:!0}),emits:["handleClick","close"],setup(e,o){let{emit:a,slots:t}=o;const s=R(null),f=d=>{a("handleClick",d)},i=d=>{a("close",d)};return()=>{const{getContainer:d,wrapperClassName:y,rootClassName:p,rootStyle:v,forceRender:w}=e,_=Ve(e,["getContainer","wrapperClassName","rootClassName","rootStyle","forceRender"]);let b=null;if(!d)return c(We,Q(Q({},_),{},{rootClassName:p,rootStyle:v,open:e.open,onClose:i,onHandleClick:f,inline:!0}),t);const M=!!t.handler||w;return(M||e.open||s.value)&&(b=c(kt,{autoLock:!0,visible:e.open,forceRender:M,getContainer:d,wrapperClassName:y},{default:F=>{var{visible:H,afterClose:r}=F,u=Ve(F,["visible","afterClose"]);return c(We,Q(Q(Q({ref:s},_),u),{},{rootClassName:p,rootStyle:v,open:H!==void 0?H:e.open,afterVisibleChange:r!==void 0?r:e.afterVisibleChange,onClose:i,onHandleClick:f}),t)}})),b}}}),oo=to,no=e=>{const{componentCls:o,motionDurationSlow:a}=e,t={"&-enter, &-appear, &-leave":{"&-start":{transition:"none"},"&-active":{transition:`all ${a}`}}};return{[o]:{[`${o}-mask-motion`]:{"&-enter, &-appear, &-leave":{"&-active":{transition:`all ${a}`}},"&-enter, &-appear":{opacity:0,"&-active":{opacity:1}},"&-leave":{opacity:1,"&-active":{opacity:0}}},[`${o}-panel-motion`]:{"&-left":[t,{"&-enter, &-appear":{"&-start":{transform:"translateX(-100%) !important"},"&-active":{transform:"translateX(0)"}},"&-leave":{transform:"translateX(0)","&-active":{transform:"translateX(-100%)"}}}],"&-right":[t,{"&-enter, &-appear":{"&-start":{transform:"translateX(100%) !important"},"&-active":{transform:"translateX(0)"}},"&-leave":{transform:"translateX(0)","&-active":{transform:"translateX(100%)"}}}],"&-top":[t,{"&-enter, &-appear":{"&-start":{transform:"translateY(-100%) !important"},"&-active":{transform:"translateY(0)"}},"&-leave":{transform:"translateY(0)","&-active":{transform:"translateY(-100%)"}}}],"&-bottom":[t,{"&-enter, &-appear":{"&-start":{transform:"translateY(100%) !important"},"&-active":{transform:"translateY(0)"}},"&-leave":{transform:"translateY(0)","&-active":{transform:"translateY(100%)"}}}]}}}},ao=e=>{const{componentCls:o,zIndexPopup:a,colorBgMask:t,colorBgElevated:s,motionDurationSlow:f,motionDurationMid:i,padding:d,paddingLG:y,fontSizeLG:p,lineHeightLG:v,lineWidth:w,lineType:_,colorSplit:b,marginSM:M,colorIcon:F,colorIconHover:H,colorText:r,fontWeightStrong:u,drawerFooterPaddingVertical:C,drawerFooterPaddingHorizontal:P}=e,T=`${o}-content-wrapper`;return{[o]:{position:"fixed",inset:0,zIndex:a,pointerEvents:"none","&-pure":{position:"relative",background:s,[`&${o}-left`]:{boxShadow:e.boxShadowDrawerLeft},[`&${o}-right`]:{boxShadow:e.boxShadowDrawerRight},[`&${o}-top`]:{boxShadow:e.boxShadowDrawerUp},[`&${o}-bottom`]:{boxShadow:e.boxShadowDrawerDown}},"&-inline":{position:"absolute"},[`${o}-mask`]:{position:"absolute",inset:0,zIndex:a,background:t,pointerEvents:"auto"},[T]:{position:"absolute",zIndex:a,transition:`all ${f}`,"&-hidden":{display:"none"}},[`&-left > ${T}`]:{top:0,bottom:0,left:{_skip_check_:!0,value:0},boxShadow:e.boxShadowDrawerLeft},[`&-right > ${T}`]:{top:0,right:{_skip_check_:!0,value:0},bottom:0,boxShadow:e.boxShadowDrawerRight},[`&-top > ${T}`]:{top:0,insetInline:0,boxShadow:e.boxShadowDrawerUp},[`&-bottom > ${T}`]:{bottom:0,insetInline:0,boxShadow:e.boxShadowDrawerDown},[`${o}-content`]:{width:"100%",height:"100%",overflow:"auto",background:s,pointerEvents:"auto"},[`${o}-wrapper-body`]:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},[`${o}-header`]:{display:"flex",flex:0,alignItems:"center",padding:`${d}px ${y}px`,fontSize:p,lineHeight:v,borderBottom:`${w}px ${_} ${b}`,"&-title":{display:"flex",flex:1,alignItems:"center",minWidth:0,minHeight:0}},[`${o}-extra`]:{flex:"none"},[`${o}-close`]:{display:"inline-block",marginInlineEnd:M,color:F,fontWeight:u,fontSize:p,fontStyle:"normal",lineHeight:1,textAlign:"center",textTransform:"none",textDecoration:"none",background:"transparent",border:0,outline:0,cursor:"pointer",transition:`color ${i}`,textRendering:"auto","&:focus, &:hover":{color:H,textDecoration:"none"}},[`${o}-title`]:{flex:1,margin:0,color:r,fontWeight:e.fontWeightStrong,fontSize:p,lineHeight:v},[`${o}-body`]:{flex:1,minWidth:0,minHeight:0,padding:y,overflow:"auto"},[`${o}-footer`]:{flexShrink:0,padding:`${C}px ${P}px`,borderTop:`${w}px ${_} ${b}`},"&-rtl":{direction:"rtl"}}}},so=St("Drawer",e=>{const o=Ct(e,{drawerFooterPaddingVertical:e.paddingXS,drawerFooterPaddingHorizontal:e.padding});return[ao(o),no(o)]},e=>({zIndexPopup:e.zIndexPopupBase}));var lo=function(e,o){var a={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&o.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(e);s<t.length;s++)o.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(e,t[s])&&(a[t[s]]=e[t[s]]);return a};const ro=["top","right","bottom","left"],Je={distance:180},io=()=>({autofocus:{type:Boolean,default:void 0},closable:{type:Boolean,default:void 0},closeIcon:A.any,destroyOnClose:{type:Boolean,default:void 0},forceRender:{type:Boolean,default:void 0},getContainer:{type:[String,Function,Boolean,Object],default:void 0},maskClosable:{type:Boolean,default:void 0},mask:{type:Boolean,default:void 0},maskStyle:re(),rootClassName:String,rootStyle:re(),size:{type:String},drawerStyle:re(),headerStyle:re(),bodyStyle:re(),contentWrapperStyle:{type:Object,default:void 0},title:A.any,visible:{type:Boolean,default:void 0},open:{type:Boolean,default:void 0},width:A.oneOfType([A.string,A.number]),height:A.oneOfType([A.string,A.number]),zIndex:Number,prefixCls:String,push:A.oneOfType([A.looseBool,{type:Object}]),placement:A.oneOf(ro),keyboard:{type:Boolean,default:void 0},extra:A.any,footer:A.any,footerStyle:re(),level:A.any,levelMove:{type:[Number,Array,Function]},handle:A.any,afterVisibleChange:Function,onAfterVisibleChange:Function,onAfterOpenChange:Function,"onUpdate:visible":Function,"onUpdate:open":Function,onClose:Function}),co=Ne({compatConfig:{MODE:3},name:"ADrawer",inheritAttrs:!1,props:Ze(io(),{closable:!0,placement:"right",maskClosable:!0,mask:!0,level:null,keyboard:!0,push:Je}),slots:Object,setup(e,o){let{emit:a,slots:t,attrs:s}=o;const f=K(!1),i=K(!1),d=K(null),y=K(!1),p=K(!1),v=ne(()=>{var h;return(h=e.open)!==null&&h!==void 0?h:e.visible});se(v,()=>{v.value?y.value=!0:p.value=!1},{immediate:!0}),se([v,y],()=>{v.value&&y.value&&(p.value=!0)},{immediate:!0});const w=pt("parentDrawerOpts",null),{prefixCls:_,getPopupContainer:b,direction:M}=xt("drawer",e),[F,H]=so(_),r=ne(()=>e.getContainer===void 0&&(b!=null&&b.value)?()=>b.value(document.body):e.getContainer);Ot(!e.afterVisibleChange,"Drawer","`afterVisibleChange` prop is deprecated, please use `@afterVisibleChange` event instead"),mt("parentDrawerOpts",{setPush:()=>{f.value=!0},setPull:()=>{f.value=!1,ue(()=>{P()})}}),Me(()=>{v.value&&w&&w.setPush()}),qe(()=>{w&&w.setPull()}),se(p,()=>{w&&(p.value?w.setPush():w.setPull())},{flush:"post"});const P=()=>{var h,O;(O=(h=d.value)===null||h===void 0?void 0:h.domFocus)===null||O===void 0||O.call(h)},T=h=>{a("update:visible",!1),a("update:open",!1),a("close",h)},l=h=>{var O;h||(i.value===!1&&(i.value=!0),e.destroyOnClose&&(y.value=!1)),(O=e.afterVisibleChange)===null||O===void 0||O.call(e,h),a("afterVisibleChange",h),a("afterOpenChange",h)},x=ne(()=>{const{push:h,placement:O}=e;let N;return typeof h=="boolean"?N=h?Je.distance:0:N=h.distance,N=parseFloat(String(N||0)),O==="left"||O==="right"?`translateX(${O==="left"?N:-N}px)`:O==="top"||O==="bottom"?`translateY(${O==="top"?N:-N}px)`:null}),q=ne(()=>{var h;return(h=e.width)!==null&&h!==void 0?h:e.size==="large"?736:378}),X=ne(()=>{var h;return(h=e.height)!==null&&h!==void 0?h:e.size==="large"?736:378}),de=ne(()=>{const{mask:h,placement:O}=e;if(!p.value&&!h)return{};const N={};return O==="left"||O==="right"?N.width=Ue(q.value)?`${q.value}px`:q.value:N.height=Ue(X.value)?`${X.value}px`:X.value,N}),me=ne(()=>{const{zIndex:h,contentWrapperStyle:O}=e,N=de.value;return[{zIndex:h,transform:f.value?x.value:void 0},ie({},O),N]}),fe=h=>{const{closable:O,headerStyle:N}=e,V=Le(t,e,"extra"),ee=Le(t,e,"title");return!ee&&!O?null:c("div",{class:Ee(`${h}-header`,{[`${h}-header-close-only`]:O&&!ee&&!V}),style:N},[c("div",{class:`${h}-header-title`},[m(h),ee&&c("div",{class:`${h}-title`},[ee])]),V&&c("div",{class:`${h}-extra`},[V])])},m=h=>{var O;const{closable:N}=e,V=t.closeIcon?(O=t.closeIcon)===null||O===void 0?void 0:O.call(t):e.closeIcon;return N&&c("button",{key:"closer",onClick:T,"aria-label":"Close",class:`${h}-close`},[V===void 0?c(Ae,null,null):V])},$=h=>{var O;if(i.value&&!e.forceRender&&!y.value)return null;const{bodyStyle:N,drawerStyle:V}=e;return c("div",{class:`${h}-wrapper-body`,style:V},[fe(h),c("div",{key:"body",class:`${h}-body`,style:N},[(O=t.default)===null||O===void 0?void 0:O.call(t)]),B(h)])},B=h=>{const O=Le(t,e,"footer");if(!O)return null;const N=`${h}-footer`;return c("div",{class:N,style:e.footerStyle},[O])},g=ne(()=>Ee({"no-mask":!e.mask,[`${_.value}-rtl`]:M.value==="rtl"},e.rootClassName,H.value)),E=ne(()=>Be(Fe(_.value,"mask-motion"))),D=h=>Be(Fe(_.value,`panel-motion-${h}`));return()=>{const{width:h,height:O,placement:N,mask:V,forceRender:ee}=e,_e=lo(e,["width","height","placement","mask","forceRender"]),he=ie(ie(ie({},s),Qe(_e,["size","closeIcon","closable","destroyOnClose","drawerStyle","headerStyle","bodyStyle","title","push","onAfterVisibleChange","onClose","onUpdate:visible","onUpdate:open","visible"])),{forceRender:ee,onClose:T,afterVisibleChange:l,handler:!1,prefixCls:_.value,open:p.value,showMask:V,placement:N,ref:d});return F(c(Mt,null,{default:()=>[c(oo,Q(Q({},he),{},{maskMotion:E.value,motion:D,width:q.value,height:X.value,getContainer:r.value,rootClassName:g.value,rootStyle:e.rootStyle,contentWrapperStyle:me.value}),{handler:e.handle?()=>e.handle:t.handle,default:()=>$(_.value)})]}))}}}),st=$t(co);function uo(e){return{all:e=e||new Map,on:function(o,a){var t=e.get(o);t?t.push(a):e.set(o,[a])},off:function(o,a){var t=e.get(o);t&&(a?t.splice(t.indexOf(a)>>>0,1):e.set(o,[]))},emit:function(o,a){var t=e.get(o);t&&t.slice().map(function(s){s(a)}),(t=e.get("*"))&&t.slice().map(function(s){s(o,a)})}}}const ve=uo(),lt=e=>(e&&(ve.on(e.name,e.callback),ft(()=>{ve.off(e.name)})),{on:ve.on,off:ve.off,emit:ve.emit,all:ve.all});async function po(e,o){const a=e.getReader();let t;for(;!(t=await a.read()).done;)o(t.value)}function mo(e){let o,a,t,s=!1;return function(i){o===void 0?(o=i,a=0,t=-1):o=_o(o,i);const d=o.length;let y=0;for(;a<d;){s&&(o[a]===10&&(y=++a),s=!1);let p=-1;for(;a<d&&p===-1;++a)switch(o[a]){case 58:t===-1&&(t=a-y);break;case 13:s=!0;case 10:p=a;break}if(p===-1)break;e(o.subarray(y,p),t),y=a,t=-1}y===d?o=void 0:y!==0&&(o=o.subarray(y),a-=y)}}function fo(e,o,a){let t=Ye();const s=new TextDecoder;return function(i,d){if(i.length===0)a==null||a(t),t=Ye();else if(d>0){const y=s.decode(i.subarray(0,d)),p=d+1,v=s.decode(i.subarray(p));switch(y){case"data":t.data=t.data?t.data+`
`+v:v;break;case"event":t.event=v;break;case"id":e(t.id=v);break;case"retry":const w=parseInt(v,10);isNaN(w)||o(t.retry=w);break}}}}function _o(e,o){const a=new Uint8Array(e.length+o.length);return a.set(e),a.set(o,e.length),a}function Ye(){return{data:"",event:"",id:"",retry:void 0}}var vo=function(e,o){var a={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&o.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(e);s<t.length;s++)o.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(e,t[s])&&(a[t[s]]=e[t[s]]);return a};const Oe="text/event-stream",ho=1e3,Xe="last-event-id";function go(e,o){var{signal:a,headers:t,onopen:s,onmessage:f,onclose:i,onerror:d,openWhenHidden:y,fetch:p}=o,v=vo(o,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((w,_)=>{const b=Object.assign({},t);b.accept||(b.accept=Oe);let M;function F(){M.abort(),document.hidden||T()}y||document.addEventListener("visibilitychange",F);let H=ho,r=0;function u(){document.removeEventListener("visibilitychange",F),window.clearTimeout(r),M.abort()}a==null||a.addEventListener("abort",()=>{u(),w()});const C=p??window.fetch,P=s??yo;async function T(){var l;M=new AbortController;try{const x=await C(e,Object.assign(Object.assign({},v),{headers:b,signal:M.signal}));await P(x),await po(x.body,mo(fo(q=>{q?b[Xe]=q:delete b[Xe]},q=>{H=q},f))),i==null||i(),u(),w()}catch(x){if(!M.signal.aborted)try{const q=(l=d==null?void 0:d(x))!==null&&l!==void 0?l:H;window.clearTimeout(r),r=window.setTimeout(T,q)}catch(q){u(),_(q)}}}T()})}function yo(e){const o=e.headers.get("content-type");if(!(o!=null&&o.startsWith(Oe)))throw new Error(`Expected content-type to be ${Oe}, Actual: ${o}`)}class bo{constructor(o={url:"",data:{}}){le(this,"onOpen");le(this,"onClose");le(this,"onError");le(this,"onMessage");le(this,"opt",{url:"",data:{}});le(this,"controller",new AbortController);le(this,"abort",()=>{this.controller.abort()});this.socketMsgQueue=[],this.opt={...this.opt,...o},this.open()}open(){const o=this;let a=new FormData;for(let t in o.opt.data)a.append(t,o.opt.data[t]);go(this.opt.url,{method:"POST",headers:{},signal:o.controller.signal,openWhenHidden:!0,body:a,async onopen(t){if(t.ok&&t.headers.get("content-type")===Oe){typeof o.onOpen=="function"&&o.onOpen();return}else throw t.status>=400&&t.status<500&&t.status!==429?new Error("连接出错"):new Error("连接出错")},onmessage(t){typeof o.onMessage=="function"&&o.onMessage(t)},onclose(){typeof o.onClose=="function"&&o.onClose(),o.controller.abort()},onerror(t){throw typeof o.onError=="function"&&o.onError(t),t}})}}const wo="",ko=e=>new bo({url:wo+"/chat/request",data:e}),So=e=>Te.post({url:"/chat/welcome",data:e}),Ke=e=>Te.post({url:"/manage/getDialogueList",data:e}),Co=e=>Te.post({url:"/chat/message",data:e}),$o=e=>Te.get({url:"/manage/getAnswerSource",params:e}),xo=_t("chat",()=>{const e=lt(),o=R([]);let a=null;const t=R(0),s=R(""),f=xe({admin_user_id:"",avatar:"",id:"",name:"",nickname:"",openid:""}),i=xe({id:"",library_ids:"",prompt:"",robot_avatar:"",robot_intro:"",robot_key:"",robot_name:"",openid:"",welcomes:{content:"",question:[]}}),d=R(!1),y=async m=>{a&&(a.abort(),a=null),o.value=[],q.value=!1,M.value=!1,m.dialogue_id?(d.value=!1,t.value=m.dialogue_id):(d.value=!0,t.value=0),s.value=m.openid||Tt(),i.robot_key=m.robot_key,i.openid=s.value,f.openid=s.value,f.avatar=m.avatar||He,f.name=m.name||"",f.nickname=m.nickname||"";const $=await So({robot_key:i.robot_key,openid:s.value,nickname:f.nickname,name:f.name,avatar:f.avatar||He,is_background:m.is_background||void 0});try{let B=$.data.customer,g=$.data.robot;return f.admin_user_id=B.admin_user_id,f.avatar=B.avatar,f.id=B.id,f.name=B.name,f.nickname=B.nickname,i.library_ids=g.library_ids,i.prompt=g.prompt,i.robot_avatar=g.robot_avatar,i.robot_intro=g.robot_intro,i.robot_key=g.robot_key,i.robot_name=g.robot_name,i.library_ids=g.library_ids,i.id=g.id,g.welcomes&&(i.welcomes=JSON.parse(g.welcomes)),p($.data.message),$}catch(B){Promise.reject(B)}},p=m=>{m&&(m.uid=$e(32),m.loading=!1,m.isWelcome=!0,m.robot_avatar=i.robot_avatar,m.menu_json&&(m.menu_json=JSON.parse(m.menu_json)),m.quote_file&&(m.quote_file=JSON.parse(m.quote_file)),o.value.push(m))},v=m=>{m.uid=$e(32),m.loading=!1,m.avatar=f.avatar,m.openid=f.openid,m.msg_type=1,m.is_customer=1,o.value.push(m)},w=m=>{o.value.push(m),e.emit("updateAiMessage",m)},_=(m,$,B)=>{let g=o.value.findIndex(E=>E.uid==B);if(m=="sending"){let E=o.value[g].content;o.value[g].content=E+$}if(m=="quote_file"&&(o.value[g].quote_file=$.length>0?$:[]),m=="ai_message"){if($.menu_json&&$.msg_type==2){let E=JSON.parse($.menu_json);o.value[g].content=E.content,o.value[g].question=E.question}o.value[g].id=$.id}m=="debug"&&(o.value[g].debug=$.length>0?$:[]),m=="error"&&(o.value[g].error=$.length>0?$:[]),e.emit("updateAiMessage",o.value[g])},b=()=>{let m=o.value.length-1;o.value[m].loading=!1},M=R(!1),F=m=>{if(M.value)return;let $={loading:!0,id:"",content:"",uid:$e(32),robot_avatar:i.robot_avatar,msg_type:1,quote_file:[],debug:[],error:""},B={robot_key:i.robot_key,openid:i.openid,question:m.message,prompt:i.prompt,library_ids:i.library_ids,dialogue_id:t.value};M.value=!0,a=ko(B),a.onMessage=g=>{if(g.event=="dialogue_id"&&(t.value=g.data),g.event=="c_message"){let E=JSON.parse(g.data);v(E)}if(g.event=="robot"&&(w($),d.value&&(T(),d.value=!1)),g.event=="sending"&&_("sending",g.data,$.uid),g.event=="ai_message"){let E=JSON.parse(g.data);_("ai_message",E,$.uid)}if(g.event=="quote_file"){let E=JSON.parse(g.data);_("quote_file",E,$.uid)}if(g.event=="debug"){let E=JSON.parse(g.data);_("debug",E,$.uid)}if(g.event=="error"){let E=g.data;_("error",E,$.uid)}},a.onClose=()=>{b(),M.value=!1,a=null}},H=25,r=R([]),u=R(!1),C=R(!1),P=async()=>{if(C.value||u.value)return!1;let m=0;r.value.length>0&&(m=r.value[r.value.length-1].id),u.value=!0;const $=await Ke({min_id:m,size:H,robot_key:i.robot_key});u.value=!1;const B=$.data||[];return B.length===0?(C.value=!0,!1):(r.value=[...r.value,...B],$)},T=()=>{Ke({min_id:0,size:1,robot_key:i.robot_key}).then(m=>{const $=m.data||[];$[0]&&r.value.unshift($[0])})},l=async m=>await y(m),x=20,q=R(!1),X=async()=>{if(q.value)return;let m=0,$=o.value.filter(g=>!g.isWelcome);$.length>0&&(m=$[0].id);let B={robot_key:i.robot_key,openid:f.openid,min_id:m,size:x,dialogue_id:t.value};try{const g=await Co(B),E=g.data.list||[];if(E.length===0){q.value=!0;return}return E.sort((D,h)=>D.id-h.id),E.forEach(D=>{D.loading=!1,D.uid=$e(32),D.is_customer==1?D.avatar=f.avatar:D.robot_avatar=i.robot_avatar,D.menu_json&&(D.menu_json=JSON.parse(D.menu_json)),D.quote_file&&(D.quote_file=JSON.parse(D.quote_file))}),o.value=[...E,...o.value],g}catch(g){Promise.reject(g)}},de=m=>{i.prompt=m},me=()=>Nt({id:i.id,prompt:i.prompt});function fe(){t.value=0,o.value=[],s.value="",f.admin_user_id="",f.avatar="",f.id="",f.name="",f.nickname="",f.openid="",i.id="",i.library_ids="",i.prompt="",i.robot_avatar="",i.robot_intro="",i.robot_key="",i.robot_name="",i.openid="",i.welcomes={content:"",question:[]},d.value=!1,q.value=!1,M.value=!1,u.value=!1,C.value=!1,r.value=[]}return{$reset:fe,user:f,robot:i,dialogue_id:t,openid:s,sendLock:M,messageList:o,createChat:y,sendMessage:F,getMyChatList:P,myChatList:r,openChat:l,onGetChatMessage:X,changeRobotPrompt:de,saveRobotPrompt:me}}),rt=e=>(we("data-v-b05538a1"),e=e(),ke(),e),Oo={class:"message-list-wrapper"},Mo={class:"message-list"},To=["id"],Lo={class:"itme-left"},Io=["src"],Po={class:"itme-right"},Eo={class:"item-body"},No={class:"message-content"},qo=["id"],Ao={class:"itme-left"},Do=["src"],Ro={class:"itme-right"},jo={class:"item-body"},Bo=["innerHTML"],Fo={class:"message-menus"},Ho=["onClick"],zo=["innerHTML"],Uo={class:"message-menus"},Wo=["onClick"],Vo={key:2,class:"message-action-wrap"},Jo={class:"message-action"},Yo={key:0,class:"action-btn"},Xo=rt(()=>n("span",null,"答案来源 ",-1)),Ko=rt(()=>n("span",null,"您可以修改相应文档并重新上传，以调整机器人的回答效果。答案来源仅后台测试时可见。",-1)),Go={key:1,class:"action-btn"},Qo=["onClick"],Zo={key:0,class:"file-items"},en=["onClick"],tn={class:"file-name"},on={__name:"message-list",props:{messages:{type:Array,default:()=>[]}},emits:["clickMsgMeun","scroll","scrollStart","scrollEnd","openPromptLog","openLibrary"],setup(e,{expose:o,emit:a}){const t=a,s=e,f=u=>{t("clickMsgMeun",u)},i=R(null),d={scrollTop:0,scrollHeight:0,clientHeight:0,scrollStartDiff:60,scrollEndDiff:60};let y=null,p=!1;function v(u){p||(y&&(clearTimeout(y),y=null),y=setTimeout(()=>{d.scrollTop=u.target.scrollTop,d.scrollHeight=u.target.scrollHeight,d.clientHeight=u.target.clientHeight,t("scroll",{...d}),Math.abs(d.scrollTop)<=d.scrollStartDiff&&w(),Math.abs(d.scrollHeight-d.scrollTop-d.clientHeight)<=d.scrollEndDiff&&_()},50))}function w(){s.messages.length!=0&&t("scrollStart",{msg:s.messages[0]})}function _(){s.messages.length!=0&&t("scrollEnd",{msg:s.messages[s.messages.length-1]})}const b=()=>{i.value&&ue(()=>{p=!0,i.value.scrollTop=i.value.scrollHeight+1,setTimeout(()=>{p=!1},50)})};function M(u,C){ue(()=>{p=!0,C||(C="top");let P=i.value,T=document.querySelector("#msg-"+u);C=="top"?P.scrollTop=T.offsetTop:P.scrollTop=T.offsetTop-P.clientHeight+T.clientHeight,setTimeout(()=>{p=!1},50)})}function F(u){return!!(u.quote_file&&u.quote_file.length>0||u.debug&&u.debug.length>0)}function H(u){t("openPromptLog",ye(u))}function r(u,C,P){let T=ye(u);T.forEach(l=>{l.message_id=P}),t("openLibrary",T,ye(C))}return o({scrollToBottom:b,scrollToMessage:M}),(u,C)=>{const P=ot,T=De;return k(),S("div",Oo,[n("div",{class:"scroll-box",ref_key:"scrollBoxRef",ref:i,onScroll:v},[n("div",Mo,[(k(!0),S(Y,null,Z(s.messages,l=>(k(),S(Y,{key:l.uid},[l.is_customer==1?(k(),S("div",{key:0,class:"message-item user-message",id:"msg-"+l.uid},[n("div",Lo,[n("img",{class:"user-avatar",src:l.avatar},null,8,Io)]),n("div",Po,[n("div",Eo,[n("div",No,j(l.content),1)])])],8,To)):(k(),S("div",{key:1,class:"message-item robot-message",id:"msg-"+l.uid},[n("div",Ao,[c(P,{size:"small",spinning:l.loading},{default:L(()=>[n("img",{class:"robot-avatar",src:l.robot_avatar},null,8,Do)]),_:2},1032,["spinning"])]),n("div",Ro,[n("div",jo,[l.msg_type==1?(k(),S(Y,{key:0},[n("div",{class:"message-content",innerHTML:l.content},null,8,Bo),n("div",Fo,[(k(!0),S(Y,null,Z(l.question,(x,q)=>(k(),S("div",{class:"menu-item",onClick:X=>f(x),key:q},j(x),9,Ho))),128))])],64)):G("",!0),l.msg_type==2?(k(),S(Y,{key:1},[n("div",{class:"message-content",innerHTML:l.menu_json.content},null,8,zo),n("div",Uo,[(k(!0),S(Y,null,Z(l.menu_json.question,(x,q)=>(k(),S("div",{class:"menu-item",onClick:X=>f(x),key:q},j(x),9,Wo))),128))])],64)):G("",!0),F(l)?Ie((k(),S("div",Vo,[n("div",Jo,[l.quote_file&&l.quote_file.length>0?(k(),S("div",Yo,[Xo,c(T,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:L(()=>[Ko]),default:L(()=>[c(z(ae))]),_:1})])):G("",!0),l.debug&&l.debug.length>0?(k(),S("div",Go,[n("span",null,[n("a",{onClick:x=>H(l)},"Prompt 日志",8,Qo)])])):G("",!0)]),l.quote_file&&l.quote_file.length>0?(k(),S("div",Zo,[(k(!0),S(Y,null,Z(l.quote_file,x=>(k(),S("div",{class:"file-item",key:x.id,onClick:q=>r(l.quote_file,x,l.id)},[n("a",tn,j(x.file_name),1)],8,en))),128))])):G("",!0)],512)),[[Pe,!l.question]]):G("",!0)])])],8,qo))],64))),128))])],544)])}}},nn=pe(on,[["__scopeId","data-v-b05538a1"]]),an={class:"chat-list-box"},sn=["onClick"],ln={class:"chat-item-title"},rn={__name:"chat-list",props:{list:{type:Array,default:()=>[]},active:{type:[String,Number],default:""}},emits:["openChat","onScrollEnd"],setup(e,{emit:o}){const a=o,t=e,s=R(null),f=d=>{a("openChat",d)},i=()=>{a("onScrollEnd")};return se(()=>t.list,()=>{ue(()=>{s.value.refresh()})}),(d,y)=>{const p=et;return k(),S("div",an,[c(At,{ref_key:"scroller",ref:s,onOnScrollEnd:i},{default:L(()=>[n("div",null,[(k(!0),S(Y,null,Z(t.list,v=>(k(),S("div",{class:Ge(["chat-list-item",{active:v.id==t.active}]),onClick:w=>f(v),key:v.id},[c(p,{class:"chat-item-icon",name:"message"}),n("span",ln,j(v.subject||v.last_chat_message),1)],10,sn))),128))])]),_:1},512)])}}},cn=pe(rn,[["__scopeId","data-v-4b3af25b"]]),ce=e=>(we("data-v-70cc02e8"),e=e(),ke(),e),dn={class:"page-right"},un={class:"page-right-body"},pn=ce(()=>n("div",{class:"prompt-tips"},[W(" 通过修改提示词可知识库可以优化机器人回答的效果。"),n("span",{style:{color:"#ed744a"}},"测试时可以直接修改提示词，不用保存即可测试优化效果。提示词优化好之后再点击保存，才会对外生效")],-1)),mn={class:"prompt-form"},fn=ce(()=>n("div",{class:"prompt-form-label"},"提示词",-1)),_n={clas:"prompt-form-item"},vn={class:"prompt-form"},hn=ce(()=>n("div",{class:"prompt-form-label"},"模型设置",-1)),gn={clas:"prompt-form-item"},yn=ce(()=>n("div",{class:"prompt-form-item-label"},[n("span",null,"LLM模型")],-1)),bn={class:"prompt-form-item-body"},wn=["src"],kn={key:0},Sn={key:1},Cn={class:"prompt-form-item"},$n={class:"prompt-form-item-label"},xn=ce(()=>n("span",null,"最大token",-1)),On=ce(()=>n("div",null,"问题+答案的最大token数，如果出现回答被截断，可调高此值",-1)),Mn={class:"form-item-body"},Tn={class:"number-box"},Ln={class:"number-slider-box"},In={class:"number-input-box"},Pn={class:"prompt-form-item"},En={class:"prompt-form-item-label"},Nn=ce(()=>n("span",null,"温度",-1)),qn={class:"form-item-body"},An={class:"number-box"},Dn={class:"number-slider-box"},Rn={class:"number-input-box"},jn={class:"prompt-form-item"},Bn={class:"prompt-form-item-label"},Fn=ce(()=>n("span",null,"上下文数量",-1)),Hn={class:"form-item-body"},zn={class:"number-box"},Un={class:"number-slider-box"},Wn={class:"number-input-box"},Vn={class:"page-right-footer"},Jn={__name:"robot-test-right",props:{robotInfo:{type:Object,default:()=>{}}},emits:["promptChange","saveRobotPrompt"],setup(e,{emit:o}){const a=e,t=o,s=xe({use_model:void 0,model_config_id:"",temperature:0,max_token:0,prompt:a.robotInfo.prompt,context_pair:0}),f=R([]),i=w=>{let _=JSON.parse(JSON.stringify(w));_.max_token=parseFloat(_.max_token),_.temperature=parseFloat(_.temperature),_.context_pair=parseFloat(_.context_pair),Object.keys(_).forEach(b=>{s[b]=_[b]})},d=(w,_)=>{s.model_config_id=_.model_config_id},y=()=>{Dt({model_type:"LLM"}).then(w=>{let _=w.data||[];f.value=_.map(b=>({id:b.model_config.id,name:b.model_info.model_name,icon:b.model_info.model_icon_url,children:b.model_info.llm_model_list,deployment_name:b.model_config.deployment_name}))})},p=w=>{s.prompt=w.currentTarget.value,t("promptChange",w)},v=()=>{t("saveRobotPrompt",s)};return Me(()=>{y(),i({...ye(a.robotInfo)})}),(w,_)=>{const b=nt,M=Rt,F=jt,H=Bt,r=Ft,u=De,C=Ht,P=zt,T=tt;return k(),S("div",dn,[n("div",un,[pn,n("div",mn,[fn,n("div",_n,[c(b,{value:s.prompt,"auto-size":{minRows:10,maxRows:10},placeholder:"请输入内容",onInput:p},null,8,["value"])])]),n("div",vn,[hn,n("div",gn,[yn,n("div",bn,[c(r,{value:s.use_model,"onUpdate:value":_[0]||(_[0]=l=>s.use_model=l),onChange:d,style:{width:"100%"}},{default:L(()=>[(k(!0),S(Y,null,Z(f.value,l=>(k(),be(H,{key:l.id},{label:L(()=>[c(M,{align:"center",gap:6},{default:L(()=>[n("img",{class:"model-icon",src:l.icon,alt:""},null,8,wn),W(j(l.name),1)]),_:2},1024)]),default:L(()=>[(k(!0),S(Y,null,Z(l.children,x=>(k(),be(F,{value:x,model_config_id:l.id,key:x},{default:L(()=>[l.name=="Azure OpenAI Service"&&l.deployment_name?(k(),S("span",kn,j(l.deployment_name),1)):(k(),S("span",Sn,j(x),1))]),_:2},1032,["value","model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])]),n("div",Cn,[n("div",$n,[xn,c(u,null,{title:L(()=>[On]),default:L(()=>[c(z(ae),{class:"question-icon"})]),_:1})]),n("div",Mn,[n("div",Tn,[n("div",Ln,[c(C,{class:"custom-slider",value:s.max_token,"onUpdate:value":_[1]||(_[1]=l=>s.max_token=l),min:0,max:100*1024},null,8,["value"])]),n("div",In,[c(P,{value:s.max_token,"onUpdate:value":_[2]||(_[2]=l=>s.max_token=l),min:0,max:100*1024},null,8,["value"])])])])]),n("div",Pn,[n("div",En,[Nn,c(u,null,{title:L(()=>[W("温度越低，回答越严谨。温度越高，回答越发散。")]),default:L(()=>[c(z(ae),{class:"question-icon"})]),_:1})]),n("div",qn,[n("div",An,[n("div",Dn,[c(C,{class:"custom-slider",value:s.temperature,"onUpdate:value":_[3]||(_[3]=l=>s.temperature=l),min:0,max:2,step:.1},null,8,["value"])]),n("div",Rn,[c(P,{value:s.temperature,"onUpdate:value":_[4]||(_[4]=l=>s.temperature=l),min:0,max:2,step:.1},null,8,["value"])])])])]),n("div",jn,[n("div",Bn,[Fn,c(u,null,{title:L(()=>[W("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:L(()=>[c(z(ae),{class:"question-icon"})]),_:1})]),n("div",Hn,[n("div",zn,[n("div",Un,[c(C,{class:"custom-slider",value:s.context_pair,"onUpdate:value":_[5]||(_[5]=l=>s.context_pair=l),min:0,max:10},null,8,["value"])]),n("div",Wn,[c(P,{value:s.context_pair,"onUpdate:value":_[6]||(_[6]=l=>s.context_pair=l),min:0,max:10},null,8,["value"])])])])])])]),n("div",Vn,[c(T,{type:"primary",block:"",onClick:v},{default:L(()=>[W("保存并应用")]),_:1})])])}}},Yn=pe(Jn,[["__scopeId","data-v-70cc02e8"]]),Xn=e=>(we("data-v-844b659e"),e=e(),ke(),e),Kn={class:"message-input-wrapper"},Gn={class:"message-action"},Qn={class:"loading-action"},Zn=["disabled"],ea=Xn(()=>n("span",null,"发送",-1)),ta=[ea],oa={__name:"message-input",props:{value:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["send","update:value"],setup(e,{emit:o}){const a=o,t=e,s=d=>{a("update:value",d.target.value)},f=d=>{if(d.key==="Enter"&&!d.shiftKey){if(!d.target.value.trim())return;d.preventDefault(),i()}else d.key==="Enter"&&d.shiftKey&&(d.preventDefault(),a("update:value",t.value+`
`))},i=()=>{a("send",t.value.trim())};return(d,y)=>{const p=nt,v=ot;return k(),S("div",Kn,[c(p,{value:e.value,"auto-size":{minRows:5,maxRows:5},placeholder:"在此输入您想了解的内容，Shift+Enter换行",onChange:s,onKeydown:f},null,8,["value"]),n("div",Gn,[n("span",Qn,[c(v,{spinning:e.loading},null,8,["spinning"])]),e.loading?G("",!0):(k(),S("button",{key:0,class:"send-msg-btn",disabled:e.loading,onClick:i},ta,8,Zn))])])}}},na=pe(oa,[["__scopeId","data-v-844b659e"]]),Se=e=>(we("data-v-9dfae593"),e=e(),ke(),e),aa={class:"prompt-log-content"},sa={class:"prompt-log-items"},la={class:"prompt-log-label"},ra=Se(()=>n("span",null,"SYSTEM ",-1)),ia={class:"prompt-log-item"},ca={class:"prompt-log-items"},da={class:"prompt-log-label"},ua=Se(()=>n("span",null,"上下文 ",-1)),pa={class:"prompt-log-items"},ma={class:"prompt-log-label"},fa=Se(()=>n("span",null,"USER ",-1)),_a={class:"prompt-log-item"},va={class:"prompt-log-items"},ha={class:"prompt-log-label"},ga=Se(()=>n("span",null,"ASSISTANT ",-1)),ya={class:"prompt-log-item"},ba={class:"prompt-log-items"},wa={class:"prompt-log-label"},ka=Se(()=>n("span",null,"Error ",-1)),Sa={class:"prompt-log-item"},Ca={__name:"prompt-log-alert",setup(e,{expose:o}){const a=R(!1),t=xe({prompt:"",library:[],context_qa:[],cur_question:"",cur_answer:"",error:""}),s=()=>{a.value=!1},f=()=>{t.prompt="",t.library=[],t.context_qa=[],t.cur_question="",t.cur_answer="",t.error=""};return o({open:d=>{f(),t.error=d.error;let y=d.debug||[];for(let p=0;p<y.length;p++){let v=y[p];v.type=="library"?t.library.push(v.content):v.type=="context_qa"?t.context_qa.push(v):t[v.type]=v.content}a.value=!0}}),(d,y)=>{const p=De,v=st;return k(),be(v,{class:"prompt-log-alert",open:a.value,"onUpdate:open":y[0]||(y[0]=w=>a.value=w),title:"Prompt 日志",placement:"right",width:"746px",closable:!1},{extra:L(()=>[n("span",{class:"close-btn",onClick:s},[c(z(Ae))])]),default:L(()=>[n("div",aa,[n("div",sa,[n("div",la,[ra,c(p,null,{title:L(()=>[W("系统提示词和文档分段。")]),default:L(()=>[c(z(ae),{class:"question-icon"})]),_:1})]),n("div",ia,[n("p",null,j(t.prompt),1)]),(k(!0),S(Y,null,Z(t.library,(w,_)=>(k(),S("div",{class:"prompt-log-item",key:_},[n("p",null,j(w),1)]))),128))]),n("div",ca,[n("div",da,[ua,c(p,null,{title:L(()=>[W("传递的历史提问消息")]),default:L(()=>[c(z(ae),{class:"question-icon"})]),_:1})]),(k(!0),S(Y,null,Z(t.context_qa,(w,_)=>(k(),S("div",{class:"prompt-log-item",key:_},[n("p",null,"Q："+j(w.question),1),n("p",null,"A："+j(w.answer),1)]))),128))]),n("div",pa,[n("div",ma,[fa,c(p,null,{title:L(()=>[W("本次用户的提问")]),default:L(()=>[c(z(ae),{class:"question-icon"})]),_:1})]),n("div",_a,[n("p",null,j(t.cur_question),1)])]),n("div",va,[n("div",ha,[ga,c(p,null,{title:L(()=>[W("语言模型输出的答案")]),default:L(()=>[c(z(ae),{class:"question-icon"})]),_:1})]),n("div",ya,[n("p",null,j(t.cur_answer),1)])]),n("div",ba,[n("div",wa,[ka,c(p,null,{title:L(()=>[W("报错信息，调用聊天接口报错时会显示。")]),default:L(()=>[c(z(ae),{class:"question-icon"})]),_:1})]),n("div",Sa,[n("p",null,j(t.error),1)])])])]),_:1},8,["open"])}}},$a=pe(Ca,[["__scopeId","data-v-9dfae593"]]),xa={class:"library-info-content"},Oa={class:"file-list"},Ma=["onClick"],Ta={class:"document-items"},La={class:"document-item-header"},Ia={class:"left-box"},Pa={class:"document-title"},Ea={key:0,class:"document-title"},Na={class:"document-size"},qa={class:"document-item-body"},Aa={class:"document-similarity"},Da={key:0,class:"document-content"},Ra={key:1,class:"document-content"},ja={class:"document-content"},Ba={__name:"library-info-alert",setup(e,{expose:o}){const a=vt(),t=R(!1),s=R([]),f=R(null),i=()=>{s.value=[],f.value=null},d=(b,M)=>{i(),s.value=b,f.value=M.id,t.value=!0,v(M)},y=b=>{b.id!=f.value&&(f.value=b.id,v(b))},p=R([]),v=b=>{$o({message_id:b.message_id,file_id:b.id}).then(M=>{p.value=M.data||[]})},w=()=>{a.push("/library/preview?id="+f.value)},_=()=>{t.value=!1};return o({open:d}),(b,M)=>{const F=et,H=st;return k(),be(H,{class:"library-info-alert",open:t.value,"onUpdate:open":M[0]||(M[0]=r=>t.value=r),title:"答案来源",placement:"right",width:"746px",closable:!1,bodyStyle:{background:"#F2F4F7"}},{extra:L(()=>[n("span",{class:"close-btn",onClick:_},[c(z(Ae))])]),default:L(()=>[n("div",xa,[n("div",Oa,[(k(!0),S(Y,null,Z(s.value,r=>(k(),S("div",{class:Ge(["file-item",{active:f.value==r.id}]),key:r.id,onClick:u=>y(r)},j(r.file_name),11,Ma))),128))]),n("div",Ta,[(k(!0),S(Y,null,Z(p.value,r=>(k(),S("div",{class:"document-item",key:r.id},[n("div",La,[n("div",Ia,[n("span",Pa,"id："+j(r.id),1),r.title?(k(),S("span",Ea,j(r.title),1)):G("",!0),n("span",Na," 共"+j(r.word_total)+"个字符 ",1)]),n("div",{class:"right-box"},[n("a",{onClick:w},"查看源文档>")])]),n("div",qa,[n("div",Aa,[W(" 相似度： "),c(F,{name:"similarity",style:{"font-size":"16px"}}),W(j(r.similarity),1)]),r.question?(k(),S("div",Da,"Q："+j(r.question),1)):G("",!0),r.answer?(k(),S("div",Ra,"A："+j(r.answer),1)):G("",!0),n("div",ja,j(r.content),1)])]))),128))])])]),_:1},8,["open"])}}},Fa=pe(Ba,[["__scopeId","data-v-d239c14f"]]),Ha=e=>(we("data-v-90a51d45"),e=e(),ke(),e),za={class:"chat-page-wrapper"},Ua={class:"chat-page-header"},Wa={class:"breadcrumb-box"},Va={class:"chat-page"},Ja={class:"page-left"},Ya={class:"page-left-top"},Xa={class:"page-left-body"},Ka=Ha(()=>n("div",{class:"page-left-footer"},null,-1)),Ga={class:"page-body"},Qa={class:"chat-box-body"},Za={style:{"margin-top":"30px"},class:"chat-box-footer"},es={__name:"index",setup(e){const a=je().query,t=Ut(),{getRobot:s,robotInfo:f}=t,i=lt(),d=xo(),y=Lt(),p=R(""),v=R(null),{createChat:w,sendMessage:_,getMyChatList:b,openChat:M,onGetChatMessage:F,changeRobotPrompt:H,$reset:r}=d,{messageList:u,sendLock:C,myChatList:P,robot:T,dialogue_id:l}=ht(d),x=je(),q=R(!1),X=async()=>{if(!p.value)return ze("请输入消息内容");D=!0,_({message:p.value}),p.value=""},de=async()=>{p.value="";let I=x.query||{},U=y.user_id,J={robot_key:I.robot_key,avatar:I.avatar,name:I.name,nickname:I.nickname,is_background:1,openid:U,dialogue_id:0};D=!0,await w(J)},me=async I=>{if(l.value==I.dialogue_id)return;D=!0;let J={robot_key:(x.query||{}).robot_key,avatar:I.avatar,name:I.name,nickname:I.nickname,is_background:I.is_background,openid:I.openid,dialogue_id:I.id};await M(J),await F()&&N()},fe=I=>{D=!0,_({message:I})},m=R(!1),$=I=>{let U=JSON.parse(JSON.stringify(ye(I)));m.value=!0;let J=U.welcomes;J.question=J.question.map(te=>te.content);let oe=U.unknown_question_prompt;oe.question=oe.question.map(te=>te.content),U.unknown_question_prompt=JSON.stringify(oe),U.welcomes=JSON.stringify(J),m.value=!0,qt(U).then(te=>{if(te.res!=0)return ze(te.msg);m.value=!1,Et("保存成功"),s(I.id)}).catch(()=>{m.value=!1})},B=I=>{H(I.currentTarget.value)},g=async I=>{It.confirm({title:"确定保存提示词吗?",icon:c(Pt),content:c("div",{style:"color:red;"},"如果您已对外提供本机器人，保存后修改的提示问也会立刻生效。如果您只是想要测试优化提示词的效果，直接修改后测试即可，无需保存。"),onOk:async()=>{$(I)},onCancel(){}})},E=()=>{v.value&&v.value.scrollToBottom()};let D=!0;const h=async()=>{D=!1;let I=u.value[0].uid;await F()&&V(I)},O=()=>{},N=()=>{v.value&&D&&v.value.scrollToBottom()},V=I=>{v.value&&v.value.scrollToMessage(I)},ee=()=>{b()},_e=R(null),he=I=>{_e.value.open(I)},Ce=R(null),ge=(I,U)=>{Ce.value.open(I,U)};return se(()=>u.value,()=>{}),Me(async()=>{de(),b(),await s(a.id),q.value=!0,i.on("updateAiMessage",E)}),qe(()=>{r(),i.off("updateAiMessage",E)}),(I,U)=>{const J=gt("router-link"),oe=Vt,te=Wt,it=tt;return k(),S("div",za,[n("div",Ua,[n("div",Wa,[c(te,null,{default:L(()=>[c(oe,null,{default:L(()=>[c(J,{to:"/robot/list"},{default:L(()=>[W("机器人管理")]),_:1})]),_:1}),c(oe,null,{default:L(()=>[W(j(z(T).robot_name),1)]),_:1})]),_:1})])]),n("div",Va,[n("div",Ja,[n("div",Ya,[c(it,{type:"primary",block:"",ghost:"",onClick:de},{default:L(()=>[c(z(Jt)),W(" 新建对话")]),_:1})]),n("div",Xa,[c(cn,{list:z(P),active:z(l),onOpenChat:me,onOnScrollEnd:ee},null,8,["list","active"])]),Ka]),n("div",Ga,[n("div",Qa,[c(nn,{ref_key:"messageListRef",ref:v,messages:z(u),onClickMsgMeun:fe,onScrollStart:h,onScrollEnd:O,onOpenPromptLog:he,onOpenLibrary:ge},null,8,["messages"])]),n("div",Za,[c(na,{value:p.value,"onUpdate:value":U[0]||(U[0]=ct=>p.value=ct),onSend:X,loading:z(C)},null,8,["value","loading"])])]),q.value?(k(),be(Yn,{key:0,onPromptChange:B,onSaveRobotPrompt:g,robotInfo:z(f)},null,8,["robotInfo"])):G("",!0)]),c($a,{ref_key:"promptLogAlertRef",ref:_e},null,512),c(Fa,{ref_key:"libraryInfoAlertRef",ref:Ce},null,512)])}}},Ps=pe(es,[["__scopeId","data-v-90a51d45"]]);export{Ps as default};
