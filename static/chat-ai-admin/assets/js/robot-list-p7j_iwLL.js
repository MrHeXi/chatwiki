import{_ as U,L as K,d as O,M as P,y as D,C as Q,E as Y,c as Z}from"../../index.js";import{e as m,w as H,M as f,N as y,k as s,S as c,Q as T,u as C,W as o,a4 as S,a5 as j,a0 as N,B as V,V as F,l as X,x as tt,F as ot,a2 as et,a8 as A,Z as E,Y as at}from"./vue-chunks-Chs-lyDX.js";import{s as nt,g as st,d as rt}from"./index-B0ITeg-u.js";import{b as lt}from"./index-Cz_YIDX3.js";import{F as B,_ as it}from"./index-VeYSCPCu.js";import{P as ct}from"./PlusOutlined-BUnPSW1-.js";import{_ as dt}from"./index-DHBKO1se.js";import"./index-9H-48H6s.js";import{I as ut}from"./Password-cmG-BlhH.js";import{_ as _t}from"./TextArea-DvaABMYL.js";import{P as pt,M as mt}from"./PlusCircleOutlined-NbNptDUg.js";import{_ as vt,M as ft}from"./index-C9DKKAWk.js";import"./index-Bz3n5ObF.js";import{D as bt}from"./dropdown-T3bZiTSp.js";import"./dayjs-CkLU8sYs.js";import"./axios-Cm0UX6qg.js";import"./qs-DjYKlG5V.js";import"./crypto-js-BUUKnz8c.js";import"./index-DBNqHYGh.js";import"./Col-CvDsueo7.js";import"./collapseMotion-DN2MDQ98.js";import"./QuestionCircleOutlined-B0hVewZq.js";import"./inputProps-DYO7gEw-.js";import"./CheckOutlined-D4HtVfaw.js";import"./index-CwZHIw9t.js";import"./slide-CP07UJ8x.js";import"./RightOutlined-BSM_93j-.js";import"./move-DwQ0mPkQ.js";const gt=r=>(S("data-v-60ead55d"),r=r(),j(),r),ht={class:"avatar-uploader"},kt=["src"],Ct={key:1},wt=gt(()=>o("div",{class:"ant-upload-text"},"上传照片",-1)),xt=["src"],Lt={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(r,{emit:w}){function b(t){return new Promise((d,L)=>{const n=new FileReader;n.readAsDataURL(t),n.onload=()=>d(n.result),n.onerror=i=>L(i)})}const h=w,x=r,g=m([]),v=m(!1),u=m("");H(()=>x.value,t=>{u.value=t},{immediate:!0});const e=B.useInjectFormItemContext(),I=()=>{let t={imageUrl:u.value,file:g.value[0].originFileObj};h("change",t),h("update:value",t.imageUrl),e.onFieldChange()},l=t=>t.type==="image/jpeg"||t.type==="image/png"?t.size/1024<100?(g.value=[t],b(t).then(n=>{u.value=n,v.value=!1,I()}),!1):(O.error("机器人头像图片大小不能超过100kb"),!1):(O.error("机器人头像只支持JPG、PNG格式的图片"),!1),a=m(!1),_=m(""),p=m(""),$=()=>{a.value=!1,p.value=""},M=async t=>{!t.url&&!t.preview&&(t.preview=await b(t.originFileObj)),_.value=t.url||t.preview,a.value=!0,p.value=t.name||t.url.substring(t.url.lastIndexOf("/")+1)};return(t,d)=>{const L=dt,n=P;return f(),y("div",ht,[s(L,{"file-list":g.value,"onUpdate:fileList":d[0]||(d[0]=i=>g.value=i),"list-type":"picture-card","show-upload-list":!1,"before-upload":l,accept:".jpg,.png,.jpeg",onPreview:M},{default:c(()=>[r.value?(f(),y("img",{key:0,class:"avatar",src:r.value,alt:"avatar"},null,8,kt)):(f(),y("div",Ct,[v.value?(f(),T(C(K),{key:0})):(f(),T(C(ct),{key:1})),wt]))]),_:1},8,["file-list"]),s(n,{open:a.value,title:p.value,footer:null,onCancel:$},{default:c(()=>[o("img",{alt:"example",style:{width:"100%"},src:_.value},null,8,xt)]),_:1},8,["open","title"])])}}},yt=U(Lt,[["__scopeId","data-v-60ead55d"]]),It=r=>(S("data-v-c17833ff"),r=r(),j(),r),$t={class:"form-box"},Mt=It(()=>o("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1)),Ot={__name:"add-robot-alert",setup(r,{expose:w}){const b=N(),h=B.useForm,x={span:4},g={span:20},v=m(!1),u=m(!1),e=V({robot_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:""}),I=V({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}]}),{validate:l,validateInfos:a,clearValidate:_}=h(e,I),p=n=>{e.robot_avatar=n.file},$=()=>{let n={robot_name:e.robot_name,robot_intro:e.robot_intro,robot_avatar:e.robot_avatar||D};u.value=!0,nt(n).then(i=>{if(u.value=!1,i.res!=0)return O.error(i.msg);O.success("机器人创建成功"),b.push("/robot/config/basic-config?id="+i.data.id)}).catch(()=>{u.value=!1})},M=async()=>{let n=await lt({model_type:"LLM"});return!n||n.data.length==0?(P.confirm({title:"请先添加LLM模型服务商?",icon:X(Q,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){b.push("/user/model")},onCancel(){}}),!1):!0},t=async()=>{await M()&&(e.robot_avatar="",e.robot_avatar_url=D,e.robot_name="",e.robot_intro="",v.value=!0)},d=()=>{_()},L=()=>{l().then(()=>{$()}).catch(n=>{})};return w({open:t}),(n,i)=>{const G=ut,R=it,J=_t,W=B,z=P;return f(),T(z,{width:"746px",open:v.value,"onUpdate:open":i[3]||(i[3]=k=>v.value=k),confirmLoading:u.value,title:"新建机器人",onOk:L,onCancel:d},{default:c(()=>[o("div",$t,[s(W,{"label-col":x,"wrapper-col":g},{default:c(()=>[s(R,F({ref:"name",label:"机器人名称"},C(a).robot_name),{default:c(()=>[s(G,{value:e.robot_name,"onUpdate:value":i[0]||(i[0]=k=>e.robot_name=k),placeholder:"请输入机器人名称"},null,8,["value"])]),_:1},16),s(R,F({label:"简介"},C(a).robot_intro),{default:c(()=>[s(J,{rows:4,value:e.robot_intro,"onUpdate:value":i[1]||(i[1]=k=>e.robot_intro=k),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"])]),_:1},16),s(R,F({ref:"name",label:"机器人头像"},C(a).robot_avatar_url),{default:c(()=>[s(yt,{value:e.robot_avatar_url,"onUpdate:value":i[2]||(i[2]=k=>e.robot_avatar_url=k),onChange:p},null,8,["value"]),Mt]),_:1},16)]),_:1})])]),_:1},8,["open","confirmLoading"])}}},Pt=U(Ot,[["__scopeId","data-v-c17833ff"]]),q=r=>(S("data-v-3d266e5e"),r=r(),j(),r),Rt={class:"robot-page"},Ft=q(()=>o("div",{class:"top-banner"},[o("div",null," 1.可以创建多个不同的机器人，不同机器人应用在不同场景中，不同机器人可以关联不同的知识库 "),o("div",null," 2.您可以复制链接将机器人提供给您的用户使用。在对外提供服务之前，建议您进行充分测试，并适当调整知识库 ")],-1)),At={class:"list-box"},Tt={class:"list-item-wrapper"},Bt=q(()=>o("span",{class:"add-text"},"新增机器人",-1)),Ut=["onClick"],St={class:"list-item"},jt=["onClick"],Dt=["onClick"],Vt={class:"robot-info"},Et=["src"],Nt={class:"robot-info-content"},qt={class:"robot-name"},Gt={class:"robot-desc"},Jt=["onClick"],Wt={__name:"robot-list",setup(r){const w=N(),b=m([]),h=()=>{st().then(l=>{b.value=l.data}).catch(()=>{})},x=m(null),g=()=>{x.value.open()},v=l=>{w.push({path:"/robot/config/basic-config",query:{id:l}})},u=l=>{let a=3,_=P.confirm({title:`删除机器人${l.robot_name}`,icon:s(Y),content:"您确定要删除此机器人吗？",okText:a+" 确 定",okType:"danger",cancelText:"取 消",okButtonProps:{disabled:!0},onOk(){e(l)},onCancel(){}}),p=setInterval(()=>{a==1?(_.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(p),p=void 0):(a-=1,_.update({okText:a+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},e=({id:l})=>{rt({id:l}).then(()=>{O.success("删除成功"),h()})},I=l=>{w.push({path:"/robot/test",query:{robot_key:l.robot_key,id:l.id}})};return tt(()=>{h()}),(l,a)=>{const _=vt,p=ft,$=bt,M=Z;return f(),y("div",Rt,[Ft,o("div",At,[o("div",Tt,[o("div",{class:"list-item add-robot",onClick:g},[s(C(pt),{class:"add-icon"}),Bt])]),(f(!0),y(ot,null,et(b.value,t=>(f(),y("div",{class:"list-item-wrapper",key:t.id,onClick:d=>v(t.id)},[o("div",St,[o("span",{class:"item-action",onClick:a[1]||(a[1]=A(()=>{},["stop"]))},[s($,null,{overlay:c(()=>[s(p,null,{default:c(()=>[s(_,null,{default:c(()=>[o("a",{href:"javascript:;",onClick:d=>v(t.id)},"管 理",8,jt)]),_:2},1024),s(_,null,{default:c(()=>[o("a",{class:"delete-text-color",href:"javascript:;",onClick:d=>u(t)},"删 除",8,Dt)]),_:2},1024)]),_:2},1024)]),default:c(()=>[o("span",{class:"menu-btn",onClick:a[0]||(a[0]=A(()=>{},["stop"]))},[s(C(mt))])]),_:2},1024)]),o("div",Vt,[o("img",{class:"robot-avatar",src:t.robot_avatar,alt:""},null,8,Et),o("div",Nt,[o("div",qt,E(t.robot_name),1),o("div",Gt,E(t.robot_intro),1)])]),o("div",{class:"robot-action",onClick:a[2]||(a[2]=A(()=>{},["stop"]))},[o("a",{onClick:d=>I(t)},[s(M,{class:"action-icon",name:"cmd"}),at(" 测试")],8,Jt)])])],8,Ut))),128))]),s(Pt,{ref_key:"addRobotAlertRef",ref:x},null,512)])}}},wo=U(Wt,[["__scopeId","data-v-3d266e5e"]]);export{wo as default};
