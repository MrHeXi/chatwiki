import{j as S,I as d,J as o,M as k,N as F,D as i,O as E,P as L,Q as K,K as O,k as B,C as z,r as I,S as J,n as j,e as q,u as v,F as w,U,V as H,W as G,b as P,o as Q,B as D,E as W}from"./vue-chunks-DTK9OVjH.js";import{I as y,J as N,K as X,L as Y,M as R}from"../../index.js";import"./axios-B4uVmeYG.js";import"./qs-DrHefV6n.js";import"./dayjs-C4iS2aBk.js";import"./crypto-js-BJ7SvduI.js";const Z=e=>(E("data-v-d1f32249"),e=e(),L(),e),ee={class:"navbar-body"},se={class:"navbar-title van-ellipsis"},te=Z(()=>o("div",{class:"navbar-right"},null,-1)),oe=S({__name:"index",props:{backgroundColor:{type:String,default:"#2475FC"},title:{type:String,default:""}},setup(e){const m=e;return(g,s)=>(i(),d("div",{class:"cu-navbar",style:F({background:m.backgroundColor})},[o("div",ee,[o("div",se,k(e.title),1)]),te],4))}}),ae=y(oe,[["__scopeId","data-v-d1f32249"]]),ne={class:"message-input-box"},le={class:"message-input-body"},ce=["value"],ie=S({__name:"message-input",props:{value:{type:String,default:""}},emits:["update:value","send"],setup(e,{emit:m}){const g=m,s=e,n=a=>{const c=a.target;g("update:value",c.value)},l=()=>{s.value.trim()&&g("send",s.value)},t=a=>{s.value.trim()&&(a.preventDefault(),l())};return(a,c)=>{const r=z("svg-icon");return i(),d("div",ne,[o("div",le,[o("div",{class:K(["message-input",{"is-set":s.value.length>0}])},[o("input",{class:"text-input",type:"text",value:e.value,placeholder:"在此输入您想了解的内容",onChange:n,onKeyup:O(t,["enter"])},null,40,ce),B(r,{name:"paper-airplane",class:"send-btn",onClick:l})],2)])])}}}),re=y(ie,[["__scopeId","data-v-62b46a50"]]),ue=S({__name:"message-list",props:{messages:{type:Array,default:()=>[]}},emits:["clickMsgMeun","scroll","scrollStart","scrollEnd"],setup(e,{expose:m,emit:g}){const s=g,n=e,l=I(null),t={scrollTop:0,scrollHeight:0,clientHeight:0,scrollStartDiff:60,scrollEndDiff:60};let a=null,c=!1;function r(){n.messages.length!=0&&s("scrollStart",{msg:n.messages[0]})}function p(){n.messages.length!=0&&s("scrollEnd",{msg:n.messages[n.messages.length-1]})}function x(_){c||(a!==null&&(clearTimeout(a),a=null),a=window.setTimeout(()=>{t.scrollTop=_.target.scrollTop,t.scrollHeight=_.target.scrollHeight,t.clientHeight=_.target.clientHeight,s("scroll",{...t}),Math.abs(t.scrollTop)<=t.scrollStartDiff&&r(),Math.abs(t.scrollHeight-t.scrollTop-t.clientHeight)<=t.scrollEndDiff&&p()},50))}const b=()=>{l.value&&j(()=>{c=!0,l.value&&(l.value.scrollTop=l.value.scrollHeight+1,setTimeout(()=>{c=!1},50))})};function $(_,h){j(()=>{c=!0,h||(h="top");let u=l.value,T=document.querySelector("#msg-"+_);!u||!T||(h=="top"?u.scrollTop=T.offsetTop:u.scrollTop=T.offsetTop-u.clientHeight+T.clientHeight,setTimeout(()=>{c=!1},50))})}return m({scrollToBottom:b,scrollToMessage:$}),(_,h)=>(i(),d("div",{class:"message-list",ref_key:"scrollBoxRef",ref:l,onScroll:x},[J(_.$slots,"default",{},void 0)],544))}}),de=y(ue,[["__scopeId","data-v-87e9df55"]]),me=e=>(E("data-v-f5fe1bbe"),e=e(),L(),e),ge=["id"],pe={class:"message-item-left"},_e=["src"],fe={class:"message-item-body"},ve={class:"message-content"},he=me(()=>o("span",{class:"triangle"},null,-1)),Te={key:0,class:"text-message"},Se={class:"text-message"},ye={key:0,class:"question-list"},be=["onClick"],Me=S({__name:"message-item",props:{msg:{type:Object,required:!0}},emits:["sendTextMessage"],setup(e,{emit:m}){const g=m,s=e,n=q(()=>s.msg.is_customer==1),l=q(()=>({"user-message-item":n.value===!0,"robot-message-item":n.value===!1,"welcome-message-item":s.msg.menu_json&&s.msg.menu_json.question})),t=a=>{g("sendTextMessage",a)};return(a,c)=>(i(),d("div",{class:K(["ignore-message-item",l.value]),id:"msg-"+e.msg.uid},[o("div",pe,[o("img",{class:"avatar",src:s.msg.avatar},null,8,_e)]),o("div",fe,[o("div",ve,[he,s.msg.msg_type==1?(i(),d("div",Te,k(v(N)(s.msg.content)),1)):s.msg.msg_type==2?(i(),d(w,{key:1},[o("div",Se,k(v(N)(s.msg.menu_json.content)),1),s.msg.menu_json&&s.msg.menu_json.question.length?(i(),d("div",ye,[(i(!0),d(w,null,U(s.msg.menu_json.question,r=>(i(),d("div",{class:"question-item",key:r,onClick:p=>t(r)},[o("span",null,k(r),1)],8,be))),128))])):H("",!0)],64)):H("",!0)])])],10,ge))}}),ke=y(Me,[["__scopeId","data-v-f5fe1bbe"]]),xe=e=>(E("data-v-5254ed7a"),e=e(),L(),e),$e={class:"chat-page"},Ce={class:"chat-page-header"},Be={class:"chat-page-body"},Ie={class:"messages-list-wrap"},we={class:"chat-page-footer"},He=xe(()=>o("div",{class:"technical-support-text"},"由chatwiki提供软件支持",-1)),Ee=S({__name:"index",setup(e){const m=Y(),g=X(),{sendMessage:s,onGetChatMessage:n,$reset:l}=g,{messageList:t,sendLock:a,externalConfigH5:c}=G(g);let r=!0;const p=I(null),x=f=>{p.value&&p.value.scrollToMessage(f)},b=()=>{p.value&&r&&p.value.scrollToBottom()},$=async()=>{r=!1;let f=t.value[0].uid;await n()&&x(f)},_=()=>{},h=async()=>{r=!0,await n()&&b()},u=I(""),T=f=>{if(!f)return R("请输入消息内容");s({message:f})},V=async()=>{if(!u.value)return R("请输入消息内容");r=!0,T(u.value),u.value=""},A=()=>{p.value&&b()};return P(()=>{h(),m.on("updateAiMessage",A)}),Q(()=>{l(),m.off("updateAiMessage",A)}),(f,C)=>(i(),d("div",$e,[o("div",Ce,[v(c).navbarShow==1?(i(),D(ae,{key:0,title:v(c).pageTitle,"background-color":v(c).pageStyle.navbarBackgroundColor},null,8,["title","background-color"])):H("",!0)]),o("div",Be,[o("div",Ie,[B(de,{ref_key:"messageListRef",ref:p,messages:v(t),onScrollStart:$,onScrollEnd:_},{default:W(()=>[(i(!0),d(w,null,U(v(t),M=>(i(),D(ke,{key:M.uid,msg:M,onSendTextMessage:T},null,8,["msg"]))),128))]),_:1},8,["messages"])])]),o("div",we,[B(re,{value:u.value,"onUpdate:value":C[0]||(C[0]=M=>u.value=M),onSend:V,loading:v(a)},null,8,["value","loading"]),He])]))}}),Re=y(Ee,[["__scopeId","data-v-5254ed7a"]]);export{Re as default};
