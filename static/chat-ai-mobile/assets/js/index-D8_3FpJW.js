import{j as S,I as d,J as o,M as k,N as O,D as i,O as E,P as L,Q as U,k as B,C as z,r as I,S as J,n as j,e as q,u as f,F as w,U as V,V as H,W as G,b as K,o as P,B as D,E as Q}from"./vue-chunks-DTK9OVjH.js";import{I as y,J as N,K as W,L as X,M as R}from"../../index.js";import"./axios-B4uVmeYG.js";import"./qs-DrHefV6n.js";import"./dayjs-C4iS2aBk.js";import"./crypto-js-BJ7SvduI.js";const Y=e=>(E("data-v-ed8600a6"),e=e(),L(),e),Z={class:"navbar-body"},ee={class:"navbar-title van-ellipsis"},se=Y(()=>o("div",{class:"navbar-right"},null,-1)),te=S({__name:"index",props:{backgroundColor:{type:String,default:"#2475FC"},title:{type:String,default:""}},setup(e){const m=e;return(g,s)=>(i(),d("div",{class:"cu-navbar",style:O({background:m.backgroundColor})},[o("div",Z,[o("div",ee,k(e.title),1)]),se],4))}}),oe=y(te,[["__scopeId","data-v-ed8600a6"]]),ae={class:"message-input-box"},ne={class:"message-input-body"},le=["value"],ce=S({__name:"message-input",props:{value:{type:String,default:""}},emits:["update:value","send"],setup(e,{emit:m}){const g=m,s=e,n=a=>{const c=a.target;g("update:value",c.value)},l=()=>{s.value.trim()&&g("send",s.value)},t=a=>{s.value.trim()&&(a.preventDefault(),l())};return(a,c)=>{const r=z("svg-icon");return i(),d("div",ae,[o("div",ne,[o("div",{class:U(["message-input",{"is-set":s.value.length>0}])},[o("input",{class:"text-input",type:"text",value:e.value,placeholder:"在此输入您想了解的内容",onChange:n,"on:pressEnter":t},null,40,le),B(r,{name:"paper-airplane",class:"send-btn",onClick:l})],2)])])}}}),ie=y(ce,[["__scopeId","data-v-91b15b4d"]]),re=S({__name:"message-list",props:{messages:{type:Array,default:()=>[]}},emits:["clickMsgMeun","scroll","scrollStart","scrollEnd"],setup(e,{expose:m,emit:g}){const s=g,n=e,l=I(null),t={scrollTop:0,scrollHeight:0,clientHeight:0,scrollStartDiff:60,scrollEndDiff:60};let a=null,c=!1;function r(){n.messages.length!=0&&s("scrollStart",{msg:n.messages[0]})}function p(){n.messages.length!=0&&s("scrollEnd",{msg:n.messages[n.messages.length-1]})}function x(_){c||(a!==null&&(clearTimeout(a),a=null),a=window.setTimeout(()=>{t.scrollTop=_.target.scrollTop,t.scrollHeight=_.target.scrollHeight,t.clientHeight=_.target.clientHeight,s("scroll",{...t}),Math.abs(t.scrollTop)<=t.scrollStartDiff&&r(),Math.abs(t.scrollHeight-t.scrollTop-t.clientHeight)<=t.scrollEndDiff&&p()},50))}const M=()=>{l.value&&j(()=>{c=!0,l.value&&(l.value.scrollTop=l.value.scrollHeight+1,setTimeout(()=>{c=!1},50))})};function $(_,h){j(()=>{c=!0,h||(h="top");let u=l.value,T=document.querySelector("#msg-"+_);!u||!T||(h=="top"?u.scrollTop=T.offsetTop:u.scrollTop=T.offsetTop-u.clientHeight+T.clientHeight,setTimeout(()=>{c=!1},50))})}return m({scrollToBottom:M,scrollToMessage:$}),(_,h)=>(i(),d("div",{class:"message-list",ref_key:"scrollBoxRef",ref:l,onScroll:x},[J(_.$slots,"default",{},void 0)],544))}}),ue=y(re,[["__scopeId","data-v-7e037515"]]),de=e=>(E("data-v-3e647e1d"),e=e(),L(),e),me=["id"],ge={class:"message-item-left"},pe=["src"],_e={class:"message-item-body"},ve={class:"message-content"},fe=de(()=>o("span",{class:"triangle"},null,-1)),he={key:0,class:"text-message"},Te={class:"text-message"},Se={key:0,class:"question-list"},ye=["onClick"],Me=S({__name:"message-item",props:{msg:{type:Object,required:!0}},emits:["sendTextMessage"],setup(e,{emit:m}){const g=m,s=e,n=q(()=>s.msg.is_customer==1),l=q(()=>({"user-message-item":n.value===!0,"robot-message-item":n.value===!1,"welcome-message-item":s.msg.menu_json&&s.msg.menu_json.question})),t=a=>{g("sendTextMessage",a)};return(a,c)=>(i(),d("div",{class:U(["ignore-message-item",l.value]),id:"msg-"+e.msg.uid},[o("div",ge,[o("img",{class:"avatar",src:s.msg.avatar},null,8,pe)]),o("div",_e,[o("div",ve,[fe,s.msg.msg_type==1?(i(),d("div",he,k(f(N)(s.msg.content)),1)):s.msg.msg_type==2?(i(),d(w,{key:1},[o("div",Te,k(f(N)(s.msg.menu_json.content)),1),s.msg.menu_json&&s.msg.menu_json.question.length?(i(),d("div",Se,[(i(!0),d(w,null,V(s.msg.menu_json.question,r=>(i(),d("div",{class:"question-item",key:r,onClick:p=>t(r)},[o("span",null,k(r),1)],8,ye))),128))])):H("",!0)],64)):H("",!0)])])],10,me))}}),be=y(Me,[["__scopeId","data-v-3e647e1d"]]),ke=e=>(E("data-v-672e2bda"),e=e(),L(),e),xe={class:"chat-page"},$e={class:"chat-page-header"},Ce={class:"chat-page-body"},Be={class:"messages-list-wrap"},Ie={class:"chat-page-footer"},we=ke(()=>o("div",{class:"technical-support-text"},"由chatwiki提供软件支持",-1)),He=S({__name:"index",setup(e){const m=X(),g=W(),{sendMessage:s,onGetChatMessage:n,$reset:l}=g,{messageList:t,sendLock:a,externalConfigH5:c}=G(g);let r=!0;const p=I(null),x=v=>{p.value&&p.value.scrollToMessage(v)},M=()=>{p.value&&r&&p.value.scrollToBottom()},$=async()=>{r=!1;let v=t.value[0].uid;await n()&&x(v)},_=()=>{},h=async()=>{r=!0,await n()&&M()},u=I(""),T=v=>{if(!v)return R("请输入消息内容");s({message:v})},F=async()=>{if(!u.value)return R("请输入消息内容");r=!0,T(u.value),u.value=""},A=()=>{p.value&&M()};return K(()=>{h(),m.on("updateAiMessage",A)}),P(()=>{l(),m.off("updateAiMessage",A)}),(v,C)=>(i(),d("div",xe,[o("div",$e,[f(c).navbarShow==1?(i(),D(oe,{key:0,title:f(c).pageTitle,"background-color":f(c).pageStyle.navbarBackgroundColor},null,8,["title","background-color"])):H("",!0)]),o("div",Ce,[o("div",Be,[B(ue,{ref_key:"messageListRef",ref:p,messages:f(t),onScrollStart:$,onScrollEnd:_},{default:Q(()=>[(i(!0),d(w,null,V(f(t),b=>(i(),D(be,{key:b.uid,msg:b,onSendTextMessage:T},null,8,["msg"]))),128))]),_:1},8,["messages"])])]),o("div",Ie,[B(ie,{value:u.value,"onUpdate:value":C[0]||(C[0]=b=>u.value=b),onSend:F,loading:f(a)},null,8,["value","loading"]),we])]))}}),Ne=y(He,[["__scopeId","data-v-672e2bda"]]);export{Ne as default};
